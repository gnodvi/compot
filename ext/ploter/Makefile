#-------------------------------------------------------------------------------
# 
#-------------------------------------------------------------------------------

MAIN_SRC_DIR = ../../src/h

include $(MAIN_SRC_DIR)/Make.mak

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# 
#-------------------------------------------------------------------------------

CC    = LANG=C gcc -Wall -g $(GLIB_INCS)

GLIB_INCS = `pkg-config --cflags glib-2.0`
GLIB_LIBS = `pkg-config --libs   glib-2.0`
GLIB_ALLS = `pkg-config --libs --cflags glib-2.0`

GTK_INCS_LIBS = `pkg-config gtk+-2.0 --cflags --libs`

T  = T
A  = .
B  = .

#-------------------------------------------------------------------------------


PLOTER   = $(B)/ploter
B_TEST_C = $(B)/ploter.c

P_TEST   = p_test
P_TEST_C = p_test.c

#-------------------------------------------------------------------------------

PROGS =  $(P_TEST) $(PLOTER) 

all: $(PROGS)

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

P_COMM_C = p_comm.c
P_COMM_H = p_comm.h
P_COMM_O = T/p_comm.o

$(P_COMM_O): $(P_COMM_C) $(P_COMM_H)                              
	$(CC) $(FLAGS) -o $@ -c $(P_COMM_C) $(GLIB_INCS)                                

#-------------------------------------------------------------------------------

P_GNUP_C = p_gnup.c
P_GNUP_H = p_gnup.h
P_GNUP_O = T/p_gnup.o

$(P_GNUP_O): $(P_GNUP_C) $(P_GNUP_H) 
	$(CC) $(CFLAGS) -c -o $@  $(P_GNUP_C) 

#-------------------------------------------------------------------------------

P_PLOT_C = p_plot.c
P_PLOT_H = p_plot.h
P_PLOT_N = $(P_COMM_H) $(P_PLOT_H) 
P_PLOT_O = T/p_plot.o


$(P_PLOT_O): $(P_PLOT_C) $(P_PLOT_N)                              
	$(CC) $(FLAGS) -o $@ -c $(P_PLOT_C)                                

#-------------------------------------------------------------------------------

$(P_TEST): $(P_TEST_C) $(P_COMM_O) $(P_GNUP_O) $(P_PLOT_O) p_plot_more.c   
	$(CC) $(FLAGS) -o $@ $^ $(GTK_INCS_LIBS)  -lm 

#-------------------------------------------------------------------------------

PLOT_LIBS = $(P_GNUP_O) $(P_PLOT_O) # $(B_PLOX_O) 

$(PLOTER): $(B_TEST_C) $(P_COMM_O) $(PLOT_LIBS) p_plot_more.c $(S_OBJS) 
	$(CC) -o $@  $(FLAGS) $^ $(GTK_INCS_LIBS)  -lm  

#-------------------------------------------------------------------------------

T/ltk-06.fas: ltk-06.cl
	clisp -Efile koi8-r -c $< -o $@ --quiet 

#-------------------------------------------------------------------------------

a_test: a_test.cc
	$(GCC)  -o $@ $^  $(TCL_INCS) $(TCL_LIBS)

#-------------------------------------------------------------------------------

T/a_capt.so: T/a_capt.o
	gcc  -shared -o $@ $^ 

T/a_capt.o: a_capt.cc
	$(GCC)  -o $@ -DNO_CONST=1 -c -fPIC $^ $(TCL_INCS) $(TCL_LIBS)


#-------------------------------------------------------------------------------

clean :
	rm -f T/*.o $(PROGS)

save :
	(cd ../m ; S.sh)

#-------------------------------------------------------------------------------
# 
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
